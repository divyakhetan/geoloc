<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>location tracking</title>
  </head>
  <body>
    <div class="location">
      my location is: <span id="myLocation"></span>
    </div>

    <script type="text/javascript">
        var id1, target, options;
        var lastTimeStamp;
        const LIMIT = 1000 * 120;
        const id = '5c7a2a256f524b002450d5ea'; // TODO: put id here
    function success(pos) {
      var crd = pos.coords;
      if(typeof lastTimeStamp === 'undefined'){ // no last timestamp
        fetch('https://availo-api.herokuapp.com/coords', {
          method: 'POST',
          headers: {
            'content-type': 'application/json',
          }
          body: {
            _id: id,
            location: crd
          }
        }).then(function(res){
            console.log(res);
        }).catch(function(err){
          console.log(err);
        })
      }
      else{
        var dt = new Date();
        if(dt.getTime() - lastTimeStamp >= LIMIT){
          lastTimeStamp = dt.getTime();
          fetch('https://availo-api.herokuapp.com/coords', {
            method: 'PATCH',
            headers: {
              'content-type': 'application/json',
            }
            body: {
              _id: id,
              location: crd
            }
          }).then(function(res){
              console.log(res);
          }).catch(function(err){
            console.log(err);
          })
        }
      }
    }

    function error(err) {
      console.warn('ERROR(' + err.code + '): ' + err.message);
    }


    options = {
      enableHighAccuracy: false,
      timeout: 5000,
      maximumAge: 0
    };

    id1 = navigator.geolocation.watchPosition(success, error, options);
    </script>
  </body>

</html>
